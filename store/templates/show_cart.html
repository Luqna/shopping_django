{% extends 'base.html' %} {% load static %} {% block title %} Cart {% endblock title %} {% block content %}

<div class="container">
  <div class="border rounded p-4 m-4">
    <p class="display-4 pl-4 ml-4">My Cart</p>
    <hr />
    <table class="table">
      <thead>
        <tr>
          <th>Id</th>
          <th>Product name</th>
          <th>Quantity</th>
          <th>Price</th>
          <th></th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for cart in cart %}
        <tr>
          <td>{{forloop.counter}}</td>
          <td>{{cart.product.name}}</td>
          <td>{{cart.quantity}}</td>
          <td>Rp. {{cart.product.price}}</td>
          <td><input type="button" pid="{{cart.product.id}}" class="minus-cart btn btn-primary" value="-" /></td>
          <td><span id="quantity">{{cart.quantity}}</span></td>
          <td><input type="button" pid="{{cart.product.id}}" class="plus-cart btn btn-primary" value="+" /></td>
          <td><input type="button" pid="{{cart.product.id}}" class="btn btn-danger btn-sm remove-cart" value="Delete" /></td>
        </tr>
      </tbody>
      {% endfor %}
    </table>
    <hr />
    <div class="m-3 p-3">
      <a href="#" class="btn btn-outline-info border rounded col=lg-3 float-right">Checkout</a>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
  var jq = jQuery.noConflict();
  jq(document).on("click", ".plus-cart", function () {
    var product_id = jq(this).attr("pid");
    jq.ajax({
      type: "GET",
      url: "{% url 'plus_cart' %}",
      data: {
        prod_id: product_id,
      },
      success: function (response) {
        console.log(response); // Periksa data yang diterima
        jq("#quantity-" + product_id).text(response.quantity);
        jq("#total-items").text(response.total_items);
      },
    });
  });
  var jq = jQuery.noConflict();
  jq(document).on("click", ".minus-cart", function () {
    var product_id = jq(this).attr("pid");
    jq.ajax({
      type: "GET",
      url: "{% url 'minus_cart' %}",
      data: {
        prod_id: product_id,
      },
      success: function (response) {
        console.log(response); // Periksa data yang diterima
        jq("#quantity-" - product_id).text(response.quantity);
        jq("#total-items").text(response.total_items);
      },
    });
  });
  var jq = jQuery.noConflict();
  jq(document).on("click", ".remove-cart", function () {
    var product_id = jq(this).attr("pid");

    jq.ajax({
      type: "GET",
      url: "{% url 'remove_cart' %}", // Pastikan URL ini benar sesuai dengan Django URL pattern
      data: {
        prod_id: product_id,
      },
      success: function (response) {
        console.log(response); // Lihat response dari server

        // Jika item berhasil dihapus, perbarui UI
        if (response.message) {
          // Hapus item dari tampilan
          jq("#cart-item-" + product_id).remove();

          // Perbarui total item di keranjang
          jq("#total-items").text(response.total_items);
        }
      },
      error: function (xhr, status, error) {
        console.error("Error:", error);
      },
    });
  });
</script>
{% endblock%}
